!function(){"use strict";function t(){this[o]=[],this[s]=0}function e(e,n){"string"==typeof e?(this.uid=e,this.title=n,this.index=new t,this.items={}):(this.uid=e.uid,this.title=e.title,this.index=e.index,this.items=e.items)}function n(t,e,n){var i,r,h,s,u;if(this.data=t,this.query=e,this.filter=n,u=this._lookup(e[e.length-1],!0),this.currentNode=u.node,this.currentIndex=0,this.queue=[],this._enqueueChildren(u.unmatched),this.end=!1,this.matchSet=null,e.length>1)for(this.matchSet={},i=0;i<e.length-1;++i){if(h=this._lookup(e[i]),!h)return this.matchSet=null,void(this.end=!0);for(h=h.node,r=0;r<h[o].length;++r)s=h[o][r],this.matchSet[s]=this.matchSet[s]||0,this.matchSet[s]+=1}}function i(t){return this.items[t]}function r(t,e){return t=t.toLowerCase().split(" "),t=t.filter(function(t){return!!t.length}),new n(this,t,e)}function h(t){t.get=i,t.search=r}var s=" count",o=" items";e.prototype._getBranchCount=function(t){var e=0;for(var n in t)" "!==n[0]&&t.hasOwnProperty(n)&&++e;return e},e.prototype._getFirstBranch=function(t){for(var e in t)if(" "!==e[0]&&t.hasOwnProperty(e))return{key:e,node:t[e]}},e.prototype._getLongestPrefix=function(t,e){var n,i=t.length>e.length?e.length:t.length;for(n=0;i>n&&t[n]===e[n];++n);return t.substr(0,n)},e.prototype._bubble=function(t,e){for(var n,i,r,h,u,l=t.length-1;l>=0;--l)if(h=t[l].key,n=t[l].node,n[s]+=e,0>e)if(l>0&&0===n[s])i=t[l-1].node,delete i[h];else if(l>0&&1===this._getBranchCount(n)&&0===n[o].length){var d=this._getFirstBranch(n);i=t[l-1].node,r=d.node,u=h+d.key,i[u]=r,delete i[h]}},e.prototype._lookup=function(t,e){for(var n=this.index,i=t,r=[{key:"",node:n}];i.length;){var h=!1;for(var s in n)if(" "!==s[0]&&n.hasOwnProperty(s)&&0===i.indexOf(s)){i=i.substr(s.length),n=n[s],r.push({key:s,node:n}),h=!0;break}if(!h)return e?(r[r.length-1].unmatched=i,r):null}return r},e.prototype._insert=function(e,n){var i,r=this._lookup(e,!0);if(r){var h=r[r.length-1];if(h.unmatched){var u,l="",d=null;i=h.node;for(var f in i)if(" "!==f[0]&&i.hasOwnProperty(f)){var a=this._getLongestPrefix(f,h.unmatched);a.length>l.length&&(l=a,d=f)}if(d){var c=d.substr(l.length);u=new t,u[s]=i[d][s],u[c]=i[d],i[l]=u,delete i[d],h.unmatched=h.unmatched.substr(l.length),r.push({key:l,node:u}),i=u}u=new t,u[o].push(n),i[h.unmatched]=u,r.push({key:h.unmatched,node:u})}else{if(i=r[r.length-1].node,-1!==i[o].indexOf(n))return;i[o].push(n)}}else i=new t,i[o].push(n),this.index[e]=i,r=[{key:"",node:this.index},{key:e,node:i}];this._bubble(r,1)},e.prototype._delete=function(t,e){var n=this._lookup(t);if(n.length>1)for(var i=n[n.length-1].node,r=0;r<i[o].length;++r)if(i[o][r][this.uid]===e){i[o].splice(r,1),this._bubble(n,-1);break}},e.prototype.insert=function(t){var e,n,i;if(n=this.items[t[this.uid]])for(e=n[this.title].toLowerCase().split(" "),e=e.filter(function(t){return!!t.length}),i=0;i<e.length;++i)this._delete(e[i],t[this.uid]);for(e=t[this.title].toLowerCase().split(" "),e=e.filter(function(t){return!!t.length}),i=0;i<e.length;++i)this._insert(e[i],t[this.uid]);this.items[t[this.uid]]=t},e.prototype["delete"]=function(t){if(this.items[t[this.uid]]){var e=t[this.title].toLowerCase().split(" ");e=e.filter(function(t){return!!t.length});for(var n=0;n<e.length;++n)this._delete(e[n],t[this.uid]);delete this.items[t[this.uid]]}},n.prototype._enqueueChildren=function(t){var e=[];for(var n in this.currentNode)this.currentNode.hasOwnProperty(n)&&e.push(n);t&&(e=e.filter(function(e){return 0===e.indexOf(t)})),e.sort();for(var i=0;i<e.length;++i)" "!==e[i][0]&&this.queue.push(this.currentNode[e[i]])},n.prototype._lookup=function(t,e){for(var n=this.data.index,i=t;i.length;){var r=!1;for(var h in n)if(" "!==h[0]&&n.hasOwnProperty(h)&&0===i.indexOf(h)){i=i.substr(h.length),n=n[h],r=!0;break}if(!r)return e?{node:n,unmatched:i}:null}return{node:n,unmatched:i}},n.prototype.next=function(){var t,e;if(this.end)return null;for(;this.currentIndex<this.currentNode[o].length;)if(t=this.currentNode[o][this.currentIndex],this.currentIndex+=1,(null===this.matchSet||this.matchSet[t]>=this.query.length-1)&&(e=this.data.items[t],!this.filter||this.filter(e)))return e;return this.currentIndex>=this.currentNode[o].length?0===this.queue.length?(this.end=!0,null):(this.currentNode=this.queue.shift(),this._enqueueChildren(),this.currentIndex=0,this.next()):void 0},n.prototype.remaining=function(){for(var t,e=[];t=this.next();)e.push(t);return e},e&&(e.prototype.get=i,e.prototype.search=r);var u=e||{prepare:h};"function"==typeof define&&define.amd?define(u):"object"==typeof exports?module.exports=u:window.RadDog=u}();