!function(){"use strict";function t(){this[s]=[],this[h]=0}function e(t,e,n){var i,r,h,o,u;if(this.data=t,this.query=e,this.filter=n,u=this._lookup(e[e.length-1],!0),this.currentNode=u.node,this.currentIndex=0,this.queue=[],this._enqueueChildren(u.unmatched),this.end=!1,this.matchSet=null,e.length>1)for(this.matchSet={},i=0;i<e.length-1;++i){if(h=this._lookup(e[i]),!h)return this.matchSet=null,void(this.end=!0);for(h=h.node,r=0;r<h[s].length;++r)o=h[s][r],this.matchSet[o]=this.matchSet[o]||0,this.matchSet[o]+=1}}function n(t){return this.items[t]}function i(t,n){return t=t.toLowerCase().split(" "),t=t.filter(function(t){return!!t.length}),new e(this,t,n)}var r,h=" count",s=" items";r=function(e,n){"string"==typeof e?(this.uid=e,this.title=n,this.index=new t,this.items={}):(this.uid=e.uid,this.title=e.title,this.index=e.index,this.items=e.items)},r.prototype._getBranchCount=function(t){var e=0;for(var n in t)" "!==n[0]&&t.hasOwnProperty(n)&&++e;return e},r.prototype._getFirstBranch=function(t){for(var e in t)if(" "!==e[0]&&t.hasOwnProperty(e))return{key:e,node:t[e]}},r.prototype._getLongestPrefix=function(t,e){var n,i=t.length>e.length?e.length:t.length;for(n=0;i>n&&t[n]===e[n];++n);return t.substr(0,n)},r.prototype._bubble=function(t,e){for(var n,i,r,o,u,l=t.length-1;l>=0;--l)if(o=t[l].key,n=t[l].node,n[h]+=e,0>e)if(l>0&&0===n[h])i=t[l-1].node,delete i[o];else if(l>0&&1===this._getBranchCount(n)&&0===n[s].length){var d=this._getFirstBranch(n);i=t[l-1].node,r=d.node,u=o+d.key,i[u]=r,delete i[o]}},r.prototype._lookup=function(t,e){for(var n=this.index,i=t,r=[{key:"",node:n}];i.length;){var h=!1;for(var s in n)if(" "!==s[0]&&n.hasOwnProperty(s)&&0===i.indexOf(s)){i=i.substr(s.length),n=n[s],r.push({key:s,node:n}),h=!0;break}if(!h)return e?(r[r.length-1].unmatched=i,r):null}return r},r.prototype._insert=function(e,n){var i,r=this._lookup(e,!0);if(r){var o=r[r.length-1];if(o.unmatched){var u,l="",d=null;i=o.node;for(var f in i)if(" "!==f[0]&&i.hasOwnProperty(f)){var a=this._getLongestPrefix(f,o.unmatched);a.length>l.length&&(l=a,d=f)}if(d){var c=d.substr(l.length);u=new t,u[h]=i[d][h],u[c]=i[d],i[l]=u,delete i[d],o.unmatched=o.unmatched.substr(l.length),r.push({key:l,node:u}),i=u}u=new t,u[s].push(n),i[o.unmatched]=u,r.push({key:o.unmatched,node:u})}else{if(i=r[r.length-1].node,-1!==i[s].indexOf(n))return;i[s].push(n)}}else i=new t,i[s].push(n),this.index[e]=i,r=[{key:"",node:this.index},{key:e,node:i}];this._bubble(r,1)},r.prototype._delete=function(t,e){var n=this._lookup(t);if(n.length>1)for(var i=n[n.length-1].node,r=0;r<i[s].length;++r)if(i[s][r]===e){i[s].splice(r,1),this._bubble(n,-1);break}},r.prototype.insert=function(t){var e,n,i,r=t[this.uid];if(n=this.items[r])for(e=n[this.title].toLowerCase().split(" "),e=e.filter(function(t){return!!t.length}),i=0;i<e.length;++i)this._delete(e[i],r);for(e=t[this.title].toLowerCase().split(" "),e=e.filter(function(t){return!!t.length}),i=0;i<e.length;++i)this._insert(e[i],r);this.items[r]=t},r.prototype["delete"]=function(t){var e=t[this.uid];if(this.items[e]){var n=t[this.title].toLowerCase().split(" ");n=n.filter(function(t){return!!t.length});for(var i=0;i<n.length;++i)this._delete(n[i],e);delete this.items[e]}},e.prototype._enqueueChildren=function(t){var e=[];for(var n in this.currentNode)this.currentNode.hasOwnProperty(n)&&e.push(n);t&&(e=e.filter(function(e){return 0===e.indexOf(t)})),e.sort();for(var i=0;i<e.length;++i)" "!==e[i][0]&&this.queue.push(this.currentNode[e[i]])},e.prototype._lookup=function(t,e){for(var n=this.data.index,i=t;i.length;){var r=!1;for(var h in n)if(" "!==h[0]&&n.hasOwnProperty(h)&&0===i.indexOf(h)){i=i.substr(h.length),n=n[h],r=!0;break}if(!r)return e?{node:n,unmatched:i}:null}return{node:n,unmatched:i}},e.prototype.next=function(){var t,e;if(this.end)return null;for(;this.currentIndex<this.currentNode[s].length;)if(t=this.currentNode[s][this.currentIndex],this.currentIndex+=1,(null===this.matchSet||this.matchSet[t]>=this.query.length-1)&&(e=this.data.items[t],!this.filter||this.filter(e)))return e;return this.currentIndex>=this.currentNode[s].length?0===this.queue.length?(this.end=!0,null):(this.currentNode=this.queue.shift(),this._enqueueChildren(),this.currentIndex=0,this.next()):void 0},e.prototype.remaining=function(){for(var t,e=[];t=this.next();)e.push(t);return e},r=r||function(t){this.uid=t.uid,this.title=t.title,this.index=t.index,this.items=t.items};var o=r;o.prototype.get=n,o.prototype.search=i,"function"==typeof define&&define.amd?define(function(){return o}):"object"==typeof exports?module.exports=o:window.RadDog=o}();